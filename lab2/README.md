# Лабораторная работа 2

**Название:** "Разработка драйверов блочных устройств"

**Цель работы:** Цель работы: получить знания и навыки разработки драйверов блочных устройств для операционной системы Linux. 
 
## Описание функциональности драйвера

* Драйвер создает виртуальный жесткий диск в оперативной  памяти с размером 50 Мбайт. 

* Созданный диск разбит на три первичных раздела с размерами 10Мбайт, 25Мбайт и  15Мбайт.

## Инструкция по сборке

1. Скачать репозиторий https://github.com/BazarovaAnna/SystemIO

2. cd lab2

3. make

4. Добавим модуль в ядро: insmod var4.ko

## Инструкция пользователя

* Создаем файловые системы на девайсах:
 
//mkfs.vfat -F16 /dev/var5p1 && mkfs.vfat -F16 /dev/var5p5

* Монтируем их в точки монтирования:

//mkdir -p /mnt/var5p1 /mnt/var5p5 && mount /dev/var5p1 /mnt/var5p1 && mount /dev/var5p5 /mnt/var5p5

* Проверка точки монтирования

$ mount -l | grep "/dev/var4"

* Размонтирование файловых систем и деинициализация драйвера:

//$ umount /dev/var5p1 && umount /dev/var5p5
$ rmmod var4

* Проверка сообщений в кольцевом буфере

//$ cd /mnt/var5p1
$ touch example
$ dmesg
...
//[var5]: Sector: 6035, Sector Offset: 0; Buffer: 00000002989b254; Length: 8 sectors

* Создание файлов на виртуальном устройстве

//$ cd /mnt/var5p1
$ echo "<Message>" > ./hello

## Примеры использования

###Измерить скорость передачи данных при копировании файлов между разделами созданного виртуального диска:

$ fallocate -l 7340032 /mnt/var5p1/example.txt              # создание файла 7Мбайт

$ pv -pr /mnt/var5p1/example.txt > /mnt/var5p5/example.txt  # копирование файла из виртуального раздела 1 в логический виртуальный раздел 5

###Измерить скорость передачи данных при копировании файлов между разделами виртуального и реального жестких дисков:

$ fallocate -l 7340032 /mnt/example.txt              # создание файла 7Мбайт

$ pv -pr /mnt/example.txt > /mnt/var5p1/example.txt  # копирование файла из реального диска в виртуальный диск